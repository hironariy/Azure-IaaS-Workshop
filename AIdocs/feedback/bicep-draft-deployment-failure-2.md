---
feedback_date: 2025-12-08
subject: Draft bicep deployment failure report 2
reviewer: Hironari Yamada
focus_areas: [technical_accuracy, azure_best_practices, implementation_clarity]
---

I attempted to deploy the Bicep templates, materials/bicep/main.bicep as per the instructions, materials/bicep/README.md, but encountered a deployment failure. Here are the details:

1. **What deployments are failing?**
  Failed deployments:
    - main
    - deploy-key-vault
    - deploy-db-tier
    - deploy-web-tier
    - deploy-vm-web-az1
    - deploy-vm-db-az1
    - deploy-vm-db-az2


2. **Error Messages Observed:**

  - For `deploy-key-vault`:
    Error messsage is following:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-key-vault",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "InvalidPrincipalId",
            "message": "A valid principal ID must be provided for role assignment."
            }
        ]
    }
    ```

    Detailed Error Logs:
    ```JSON
    {
        "code": "InvalidPrincipalId",
        "message": "A valid principal ID must be provided for role assignment."
    }
    ```

    - For `deploy-db-tier`:
    Error message is following:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-db-tier",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az1",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'."
            },
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az2",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'."
            }
        ]
    }
    ```

    Detailed Error Logs for deploy-vm-db-az1:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az1",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-db-az1-prod/extensions/CustomScript",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.",
            "details": [
                {
                "code": "VMExtensionProvisioningError",
                "message": "VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (7354 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2852 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "
                }
            ]
            }
        ]
    }
    ```

    Detailed Error Logs for deploy-vm-db-az2:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az2",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-db-az2-prod/extensions/CustomScript",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.",
            "details": [
                {
                "code": "VMExtensionProvisioningError",
                "message": "VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (6927 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2922 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "
                }
            ]
            }
        ]
    }
    ```

    - For `deploy-web-tier`:
    Error message is following:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-web-tier",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-web-az1",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'."
            }
        ]
    }
    ```

    Detailed Error Logs for deploy-vm-web-az1:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-web-az1",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-web-az1-prod/extensions/CustomScript",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.",
            "details": [
                {
                "code": "VMExtensionProvisioningError",
                "message": "VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (7042 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2810 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "
                }
            ]
            }
        ]
    }
    ```

    - For`deploy-vm-web-az1`:
    Error message is following:
    ```JSON
    {
        "code": "DeploymentFailed",
        "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-web-az1",
        "message": "At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.",
        "details": [
            {
            "code": "ResourceDeploymentFailure",
            "target": "/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-web-az1-prod/extensions/CustomScript",
            "message": "The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'."
            }
        ]
    }
    ```

    Detailed Error Logs for deploy-vm-app-az1:
    ```JSON
    {
        "code": "VMExtensionProvisioningError",
        "message": "VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (7042 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2810 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "
    } 
    ```

    - For`deploy-vm-db-az2`:
    Error message is following:
    ```JSON
    {
        "code": "VMExtensionProvisioningError",
        "message": "VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (6927 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2922 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "
    }
    ```


    - For`deploy-vm-db-az1`:
    Error message is following:
    ```JSON
    {
        "code": "VMExtensionProvisioningError",
        "message": "VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (7354 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2852 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "
    }
    ```

3. **Other Messages Observed:**

- App tier VMs

I found App tier VMs are successfully created.

- Errors in ternminal

I found error messages in the terminal as following:
```
hironariy@HironariyMBP2023 AzureIaaSWorkshop % cd /Users/hironariy/dev/AzureIaaSWorkshop/materials/bicep && az deployment group
 create \
cmdand>   -g rg-workshop-test \
cmdand>   --template-file main.bicep \
cmdand>   --parameters \
cmdand>     sshPublicKey="$(cat ~/.ssh/id_rsa.pub)" \
cmdand>     adminObjectId="$ADMIN_OBJECT_ID" \
cmdand>     environment="prod" \
cmdand>   --query "properties.provisioningState" -o tsv
{"status":"Failed","error":{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/main","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-web-tier","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-web-tier","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-web-az1","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-web-az1","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-web-az1-prod/extensions/CustomScript","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"VMExtensionProvisioningError","message":"VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (7042 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2810 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "}]}]}]}]}]},{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-db-tier","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-db-tier","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az1","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az1","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-db-az1-prod/extensions/CustomScript","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"VMExtensionProvisioningError","message":"VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (7354 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2852 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "}]}]}]},{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az2","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-vm-db-az2","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Compute/virtualMachines/vm-db-az2-prod/extensions/CustomScript","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"VMExtensionProvisioningError","message":"VM has reported a failure when processing extension 'CustomScript' (publisher 'Microsoft.Azure.Extensions' and type 'CustomScript'). Error message: 'Enable failed: failed to execute command: command terminated with exit status=100\n[stdout]\nHit:1 http://azure.archive.ubuntu.com/ubuntu jammy InRelease\nGet:2 http://azure.archive.ubuntu.com/ubuntu jammy-updates InRelease [128 kB]\nGet:3 http://azure.archive.ubuntu.com/ubuntu jammy-backports InRelease [127 kB]\nGet:4 http://azure.archive.ubuntu.com/ubuntu jammy-security InRelease [129 kB]\nGet:5 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 Packages [14.1 MB]\nGet:6 http://azure.archive.ubuntu.com/ubuntu jammy/universe Translation-en [5652 kB]\nGet:7 http://azure.archive.ubuntu.com/ubuntu jammy/universe amd64 c-n-f Metadata [286 kB]\nGet:8 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 Packages [217 kB]\nGet:9 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse Translation-en [112 kB]\nGet:10 http://azure.archive.ubuntu.com/ubuntu jammy/multiverse amd64 c-n-f Metadata [8372 B]\nGet:11 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 Packages [3109 kB]\nGet:12 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main Translation-en [478 kB]\nGet:13 http://azure.archive.ubuntu.com/ubuntu jammy-updates/main amd64 c-n-f Metadata [19.0 kB]\nGet:14 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted amd64 Packages [4939 kB]\nGet:15 http://azure.archive.ubuntu.com/ubuntu jammy-updates/restricted Translation-en [921 kB]\nGet:16 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 Packages [1244 kB]\nGet:17 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe Translation-en [310 kB]\nGet:18 http://azure.archive.ubuntu.com/ubuntu jammy-updates/universe amd64 c-n-f Metadata [30.0 kB]\nGet:19 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 Packages [57.6 kB]\nGet:20 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse Translation-en [13.2 kB]\nGet:21 http://azure.archive.ubuntu.com/ubuntu jammy-updates/multiverse amd64 c-n-f Metadata [600 B]\nGet:22 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 Packages [69.4 kB]\nGet:23 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main Translation-en [11.5 kB]\nGet:24 http://azure.archive.ubuntu.com/ubuntu jammy-backports/main amd64 c-n-f Metadata [412 B]\nGet:25 http://azure.archive.ubuntu.com/ubuntu jammy-backports/restricted amd64 c-n-f Metadata [116 B]\nGet:26 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 Packages [30.1 kB]\nGet:27 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe Translation-en [16.6 kB]\nGet:28 http://azure.archive.ubuntu.com/ubuntu jammy-backports/universe amd64 c-n-f Metadata [672 B]\nGet:29 http://azure.archive.ubuntu.com/ubuntu jammy-backports/multiverse amd64 c-n-f Metadata [116 B]\nGet:30 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 Packages [2850 kB]\nGet:31 http://azure.archive.ubuntu.com/ubuntu jammy-security/main Translation-en [411 kB]\nGet:32 http://azure.archive.ubuntu.com/ubuntu jammy-security/main amd64 c-n-f Metadata [13.9 kB]\nGet:33 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted amd64 Packages [4784 kB]\nGet:34 http://azure.archive.ubuntu.com/ubuntu jammy-security/restricted Translation-en [896 kB]\nGet:35 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 Packages [1006 kB]\nGet:36 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe Translation-en [220 kB]\nGet:37 http://azure.archive.ubuntu.com/ubuntu jammy-security/universe amd64 c-n-f Metadata [22.3 kB]\nGet:38 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 Packages [50.5 kB]\nGet:39 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse Translation-en [10.2 kB]\nGet:40 http://azure.archive.ubuntu.com/ubuntu jammy-security/multiverse amd64 c-n-f Metadata [376 B]\nFetched 42.3 MB in 6s (6927 kB/s)\nReading package lists...\n\n[stderr]\nE: Could not get lock /var/lib/dpkg/lock-frontend. It is held by process 2922 (dpkg)\nE: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?\n'. More information on troubleshooting is available at https://aka.ms/VMExtensionCSELinuxTroubleshoot. "}]}]}]}]}]},{"code":"ResourceDeploymentFailure","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-key-vault","message":"The resource write operation failed to complete successfully, because it reached terminal provisioning state 'Failed'.","details":[{"code":"DeploymentFailed","target":"/subscriptions/78d2b28b-2bad-42b5-b773-6846e2da2866/resourceGroups/rg-workshop-test/providers/Microsoft.Resources/deployments/deploy-key-vault","message":"At least one resource deployment operation failed. Please list deployment operations for details. Please see https://aka.ms/arm-deployment-operations for usage details.","details":[{"code":"InvalidPrincipalId","message":"A valid principal ID must be provided for role assignment."}]}]}]}}
```
